<app-container width="medium">
  <app-top-bar-filter
    [text]="initialFilterText"
    placeholder="Flow durchsuchen..."
    (filterChanged)="onFilterChanged($event)"
  >
    <button type="button" class="btn-icon" (click)="showAddItemModal()" title="Element hinzuf端gen" *ngIf="user.isGM">
      <fa-icon [icon]="faPlus" [fixedWidth]="true"></fa-icon>
    </button>

    <button type="button" class="btn-icon" (click)="showAddNoteModal()" title="Notiz hinzuf端gen" *ngIf="user.isGM">
      <fa-icon [icon]="faStickyNote" [fixedWidth]="true"></fa-icon>
    </button>

    <button type="button" class="btn-icon" (click)="showEditFlowModal()" title="Session bearbeiten" *ngIf="user.isGM">
      <fa-icon [icon]="faEdit" [fixedWidth]="true"></fa-icon>
    </button>
  </app-top-bar-filter>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <p>Lade Flow...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <p>{{ error }}</p>
  </div>

  <!-- Empty State (no items at all) -->
  <div *ngIf="(enrichedFlowItems$ | async)?.length === 0 && !loading && !error" class="empty-state">
    <div class="empty-state-content">
      <fa-icon [icon]="faStickyNote" size="3x"></fa-icon>
      <p>Du hast noch keine Elemente zu deinem Session-Flow hinzugef端gt</p>
      <button type="button" class="btn" (click)="showAddItemModal()">Erstes Element hinzuf端gen</button>
    </div>
  </div>

  <!-- No Results State (items exist but none match filter) -->
  <div *ngIf="(enrichedFlowItems$ | async)?.length > 0 && (filteredFlowItems$ | async)?.length === 0 && !loading && !error" class="empty-state">
    <div class="empty-state-content">
      <p>Keine Ergebnisse gefunden</p>
    </div>
  </div>

  <!-- Flow Items -->
  <div
    *ngIf="(filteredFlowItems$ | async)?.length > 0 && !loading"
    cdkDropList
    [cdkDropListData]="filteredFlowItems$ | async"
    (cdkDropListDropped)="onDrop($event)"
    class="flow-items"
  >
    <div *ngFor="let item of filteredFlowItems$ | async" cdkDrag class="flow-item-wrapper">
      <app-flow-item
        [dragEnabled]="filterText$.value ===''"
        [item]="item"
        (remove)="removeItem($event)"
      ></app-flow-item>
    </div>
  </div>
</app-container>
