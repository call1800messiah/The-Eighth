<div class="add-flow-item-modal">
  <div class="modal-tabs">
    <button
      type="button"
      class="tab-btn"
      [class.active]="activeTab === 'quest'"
      (click)="switchTab('quest')"
    >
      Quest
    </button>
    <button
      type="button"
      class="tab-btn"
      [class.active]="activeTab === 'person'"
      (click)="switchTab('person')"
    >
      Person
    </button>
    <button
      type="button"
      class="tab-btn"
      [class.active]="activeTab === 'place'"
      (click)="switchTab('place')"
    >
      Ort
    </button>
    <button
      type="button"
      class="tab-btn"
      [class.active]="activeTab === 'note'"
      (click)="switchTab('note')"
    >
      Notiz
    </button>
  </div>

  <div class="modal-body">
    <!-- Quest Tab -->
    <div *ngIf="activeTab === 'quest'" class="tab-content">
      <div class="form-group">
        <input
          type="text"
          id="quest-search"
          [value]="searchText$ | async"
          (input)="onSearchChange($event.target.value)"
        />
        <label for="quest-search">Quest suchen...</label>
      </div>

      <div class="entity-list">
        <div
          *ngFor="let quest of filteredQuests$ | async"
          class="entity-item form-group"
          [class.selected]="isSelected(quest.id)"
        >
          <input id="quest-{{quest.id}}" type="checkbox" [checked]="isSelected(quest.id)" (click)="toggleSelection(quest.id)" />
          <label class="entity-name" for="quest-{{quest.id}}">{{ quest.name }}</label>
        </div>
      </div>
    </div>

    <!-- Person Tab -->
    <div *ngIf="activeTab === 'person'" class="tab-content">
      <div class="form-group">
        <input
          type="text"
          id="person-search"
          [value]="searchText$ | async"
          (input)="onSearchChange($event.target.value)"
        />
        <label for="person-search">Person suchen...</label>
      </div>

      <div class="entity-list">
        <div
          *ngFor="let person of filteredPeople$ | async"
          class="entity-item form-group"
          [class.selected]="isSelected(person.id)"
        >
          <input id="person-{{person.id}}" type="checkbox" [checked]="isSelected(person.id)" (click)="toggleSelection(person.id)" />
          <label class="entity-name" for="person-{{person.id}}">{{ person.name }}</label>
          <app-avatar [person]="person"></app-avatar>
        </div>
      </div>
    </div>

    <!-- Place Tab -->
    <div *ngIf="activeTab === 'place'" class="tab-content">
      <div class="form-group">
        <input
          type="text"
          id="place-search"
          [value]="searchText$ | async"
          (input)="onSearchChange($event.target.value)"
        />
        <label for="place-search">Ort suchen...</label>
      </div>

      <div class="entity-list">
        <div
          *ngFor="let place of filteredPlaces$ | async"
          class="entity-item form-group"
          [class.selected]="isSelected(place.id)"
        >
          <input id="place-{{place.id}}" type="checkbox" [checked]="isSelected(place.id)" (click)="toggleSelection(place.id)" />
          <label class="entity-name" for="place-{{place.id}}">{{ place.name }}</label>
        </div>
      </div>
    </div>

    <!-- Note Tab -->
    <div *ngIf="activeTab === 'note'" class="tab-content">
      <div class="form-group">
        <input
          type="text"
          id="note-search"
          [value]="searchText$ | async"
          (input)="onSearchChange($event.target.value)"
        />
        <label for="note-search">Notiz suchen...</label>
      </div>

      <div class="entity-list">
        <div
          *ngFor="let note of filteredNotes$ | async"
          class="entity-item form-group"
          [class.selected]="isSelected(note.id)"
        >
          <input id="note-{{note.id}}" type="checkbox" [checked]="isSelected(note.id)" (click)="toggleSelection(note.id)" />
          <label class="entity-name" for="note-{{note.id}}">
            <div>
              <span class="note-title" *ngIf="note.title">{{ note.title }}</span>
              <span class="note-content" *ngIf="!note.title">{{ note.content.slice(0,35) }}</span>
            </div>
            <div class="note-category" *ngIf="note.category">[{{ note.category }}]</div>
          </label>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-footer">
    <button type="button" class="btn" (click)="close()">Abbrechen</button>
    <button
      type="button"
      class="btn btn-primary"
      (click)="addSelected()"
      [disabled]="selectedItems.length === 0"
    >
      Ausgewählte hinzufügen ({{ selectedItems.length }})
    </button>
  </div>
</div>
